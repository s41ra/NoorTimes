<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Today's Events | Islamic App</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ====================================================================
        1. Base & Utilities
        ==================================================================== */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        /* ** Global Box Sizing ** */
        *, ::before, ::after {
            box-sizing: border-box;
        }

        /* *** CRITICAL CHANGE FOR 100VH AND NO SCROLLING *** */
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* Ensure no page-level scrolling */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            justify-content: center; /* Center app container horizontally */
            align-items: stretch; /* Allow app container to take full height */
        }

        /* Adjusted app-container for max-width management and centering */
        .app-container {
            max-width: 480px; /* Constrains the max width of the app frame */
            width: 100%;
            height: 100vh; /* Set height to full viewport height */
            padding: 0;

            /* KEY CHANGE: Use Flexbox to center the content */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */

            /* Ensure NO scrolling on the main container */
            overflow: hidden;
        }

        /* Content wrapper ensures content has padding and can adapt if needed */
        .content-wrapper {
            width: 100%;
            padding: 1rem;
            display: flex;
            justify-content: center;
            /* Prevent the wrapper from being squeezed/truncated by the flex centering */
            flex-shrink: 0;
        }

        /* ====================================================================
        2. Animation Classes (NEW)
        ==================================================================== */
        .search-icon {
            display: inline-block;
            margin-right: 0.5rem;
            animation: pulse-search 1.5s infinite ease-in-out;
        }

        @keyframes pulse-search {
            0%, 100% {
                transform: scale(1);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="flex flex-col">

<main class="app-container">
    <div class="content-wrapper">
        <div id="event-summary" class="text-center p-8 bg-white border border-gray-200 rounded-lg shadow-xl w-full max-w-sm">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Today's Events</h1>
            <h2 id="current-date-display" class="text-lg font-semibold text-gray-700 mb-6"></h2>

            <p id="event-count-message" class="text-xl font-bold text-emerald-600">
            </p>

            <p id="loading-status" class="text-center text-gray-500 text-sm font-medium mt-8 flex items-center justify-center">
                <span id="search-animation" class="search-icon text-2xl text-emerald-600">
                    üîç
                </span>
                Checking for today's events...
            </p>
        </div>
    </div>
</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

        // Firebase configuration (REMAINS THE SAME)
        const firebaseConfig = {
            apiKey: "AIzaSyByJOqTUojiL1wN7_i_cHMAukuJWzIZVck",
            authDomain: "clothsuggest.firebaseapp.com",
            databaseURL: "https://clothsuggest-default-rtdb.firebaseio.com/",
            projectId: "clothsuggest",
            storageBucket: "clothsuggest.firebasestorage.app",
            messagingSenderId: "758790774735",
            appId: "1:758790774735:web:5f5ea17048273416cd7cba",
            measurementId: "G-4H8WZL0S4F"
        };

        // Initialize Firebase app and DB
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // DOM Elements
        const eventCountMessage = document.getElementById('event-count-message');
        const loadingStatus = document.getElementById('loading-status');
        const currentDateDisplay = document.getElementById('current-date-display');
        const searchAnimation = document.getElementById('search-animation'); // New element reference

        // --- Utility Functions ---

        /** Formats date into YYYY-MM-DD string */
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        // --- Core Function: Fetch and Display Today's Events ---

        /** Fetches all events and filters for today's events. */
        function fetchAndDisplayTodayEvents() {
            const today = new Date();
            const todayString = formatDate(today);

            // Format the date for the title display
            currentDateDisplay.textContent = today.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            loadingStatus.classList.remove('hidden');
            searchAnimation.classList.remove('hidden'); // Ensure icon is visible during loading

            // Reference to the main events node
            const eventsRef = ref(db, 'events');

            onValue(eventsRef, (snapshot) => {
                const data = snapshot.val();
                let eventCount = 0;

                if (data) {
                    // Filter for only today's events and count them
                    Object.keys(data).forEach(key => {
                        const event = data[key];
                        if (event.date === todayString) {
                            eventCount++;
                        }
                    });
                }

                renderEventCount(eventCount);
                loadingStatus.classList.add('hidden');
                searchAnimation.classList.add('hidden'); // Hide icon once loading is done

            }, (error) => {
                console.error("Firebase Read Error:", error);
                loadingStatus.textContent = '‚ùå Error loading events.';
                searchAnimation.classList.add('hidden'); // Hide icon on error
            });
        }

        /** Renders the event count message. */
        function renderEventCount(count) {
            eventCountMessage.classList.remove('text-red-500', 'text-emerald-600');
            let message = '';

            if (count > 0) {
                const eventWord = count === 1 ? 'event' : 'events';
                message = `You have ${count} ${eventWord} today. Please check it.`;
                eventCountMessage.classList.add('text-emerald-600');
            } else {
                message = `No events today, Alhamdulillah!`;
                eventCountMessage.classList.add('text-red-500');
            }

            eventCountMessage.textContent = message;
        }

        // Initial load
        fetchAndDisplayTodayEvents();
    </script>

</body>
</html>