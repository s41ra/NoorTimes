package com.example.islamic;

import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.webkit.WebChromeClient; // ðŸ‘ˆ Import WebChromeClient
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.widget.ImageButton;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;

public class AccountFragment_admin extends Fragment {

private TextView titleTextView;
private ImageButton logoutButton;
private WebView webView;

private static final String ARG_PARAM1 = "param1";
private static final String ARG_PARAM2 = "param2";
private String mParam1;
private String mParam2;

// âœ… Use the same constants as Login.java
private static final String PREF_FILE_NAME = "IslamicAppPrefs";
private static final String KEY_USERNAME = "current_username";

public AccountFragment_admin() {
// Required empty public constructor
}

public static AccountFragment_admin newInstance(String param1, String param2) {
AccountFragment_admin fragment = new AccountFragment_admin();
Bundle args = new Bundle();
args.putString(ARG_PARAM1, param1);
args.putString(ARG_PARAM2, param2);
fragment.setArguments(args);
return fragment;
}

@Override
public void onCreate(@Nullable Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
if (getArguments() != null) {
mParam1 = getArguments().getString(ARG_PARAM1);
mParam2 = getArguments().getString(ARG_PARAM2);
}
}

@Override
public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,
Bundle savedInstanceState) {
return inflater.inflate(R.layout.fragment_account_admin, container, false);
}

@Override
public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
super.onViewCreated(view, savedInstanceState);

// Initialize UI components
titleTextView = view.findViewById(R.id.title);
logoutButton = view.findViewById(R.id.logout_button);
webView = view.findViewById(R.id.webview);

// Load the username from SharedPreferences
String username = getUsername();
//     titleTextView.setText("Hello " + username);

// Setup the WebView
setupWebView();

// Logout button action
logoutButton.setOnClickListener(v -> handleLogout());
}

private void setupWebView() {
webView.getSettings().setJavaScriptEnabled(true);
// Add DOM Storage setting
webView.getSettings().setDomStorageEnabled(true); // ðŸ‘ˆ Added setting for DOM Storage
webView.setWebViewClient(new WebViewClient());
// Set the WebChromeClient
webView.setWebChromeClient(new WebChromeClient()); // ðŸ‘ˆ Added WebChromeClient
webView.loadUrl("file:///android_asset/admin_profile.html");
}

private String getUsername() {
SharedPreferences prefs = requireActivity().getSharedPreferences(PREF_FILE_NAME, getContext().MODE_PRIVATE);
return prefs.getString(KEY_USERNAME, "Admin");
}

private void handleLogout() {
// âœ… Clear the same SharedPreferences used in Login.java
SharedPreferences prefs = requireActivity().getSharedPreferences(PREF_FILE_NAME, getContext().MODE_PRIVATE);
prefs.edit().clear().apply();

// âœ… Redirect to Login and clear the back stack
Intent intent = new Intent(getActivity(), Login.class);
intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);
startActivity(intent);
}
}